// Generated by CoffeeScript 1.6.3
(function() {
  var fs, generateRandomId, oss, ossAPI, _;

  _ = require("underscore");

  ossAPI = require('oss-client');

  fs = require("fs");

  oss = null;

  generateRandomId = function() {
    return "" + ((Math.random() * 36 >> 0).toString(36)) + ((Math.random() * 36 >> 0).toString(36)) + (Date.now().toString(36));
  };

  exports.init = function(key, secret) {
    if (!(_.isString(key) && _.isString(secret) && key.length > 0 && secret.length > 0)) {
      throw new Error("Invalid arguments. key:" + key + ", secret:" + secret);
    }
    oss = new ossAPI.OssClient({
      accessKeyId: key,
      accessKeySecret: secret
    });
  };

  exports.readFile = function(bucketName, filename, options, callback) {
    var args;
    if (oss == null) {
      throw new Error("Please run oss-easy.init() first");
    }
    args = {
      bucket: bucket,
      object: filename,
      dstFile: dstFile
    };
    oss.getObject(args, callback);
  };

  exports.writeFile(bucketName, filename, data, callback)(function() {
    var pathToTempFile;
    if (oss == null) {
      throw new Error("Please run oss-easy.init() first");
    }
    pathToTempFile = "/tmp/" + (generateRandomId());
    fs.writeFile(pathToTempFile, data, function(err) {
      var args;
      if (err != null) {
        return callback(err);
      } else {
        args = {
          bucket: bucket,
          object: filename,
          srcFile: pathToTempFile
        };
        return oss.putObject(args, callback);
      }
    });
  });

}).call(this);
